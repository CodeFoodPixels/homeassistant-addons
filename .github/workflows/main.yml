on:
  workflow_dispatch:
  push:
    branches:
      - main
    paths:
      - "*!(.*)/**"
      
jobs:
  check-addon-changes:
    runs-on: ubuntu-latest
    outputs:
      changedAddons: ${{ steps.filter.outputs.changes }}
    steps:
      - run: sudo apt update && sudo apt install tree jq -y
        shell: bash
      
      - name: Checkout
        uses: actions/checkout@v3
        
      - name: Generate Filter List
        id: set-folders
        shell: bash
        run: |
          filters=$(tree -J -d -L 1 | jq -c '.[0].contents | map({(.name|tostring): (.name|tostring + "/**")}) | add')
          echo $filters
          echo "filters=$filters" >> $GITHUB_OUTPUT

      - name: Detect changed files
        uses: dorny/paths-filter@v2
        id: filter
        with:
          filters: |
            ${{ fromJSON(steps.set-folders.outputs.filters) }}
